# Franka Research 3 入门使用文档

文档开始于：2025 年8 月13 日

---

## 1 目前存在的问题

### 1.1 影响使用的问题

- 固件版本问题：安装环境（主要是 libfranka 和 franka_ros2）时要严格按照手册中的版本规范（详见 Franka World 中操作手册）。现在右机机臂的固件版本为 5.7.1，而我们现有环境支持 5.7.2 及以上固件。建议将右机机臂固件升级到与左机机臂固件版本一致，即 5.8 版本。

> 一致的固件和环境非常重要！如果不一致的固件，将会导致两台机械臂开发的代码无法进行互通。

> 我们已经尝试了很多种方法使控制箱直接接入外网，以期通过此方式完成固件升级但均失败了。建议直接联系厂商服务方获取帮助。

* RT 内核问题：不管是在官方手册还是视频教程中，均强调了实时内核的重要性。没有实时内核就无法严格保证机器控制的实时性和运行的稳定性。在一段时间不控制机械臂后则会**抛出超时报错**，严重阻碍研发的进度。

如果想要升级实时内核，请不要按照操作手册的方法（即下载源代码后编译的方式），此方法会出现无法进入 Grub 引导界面的问题。为了不走弯路，请通过注册 Ubuntu 账号，升级 Ubuntu Pro 的方式完成该步骤（该方式不收费，一个账号可以免费给 5 台机器升级为 Ubuntu Pro）。

具体步骤见此博客:[[【原创】Ubuntu22.04安装 PREEMPT-RT(Ubuntu Pro RealTime linux/realtime Ubuntu)-CSDN博客](https://blog.csdn.net/qq_22654551/article/details/129905097)]

请注意，RT 内核必须部署在宿主机上，而不是在 Docker 容器中进行部署。

部署后请在终端中输入

`umame -a`

以查看是否已经安装好 RT 内核。

请注意，在部署好实时内核后，还会出现 Docker 容器无法使用该内核的情况。这里与Docker权限有关，请注意。

* 在长时间运行机械臂后，会出现moveit节点控制失精的问题

        目前不知道问题出现的原因，在经验上可采用彻底重启机械臂和Moveit接口服务的方式来解决该问题。

### 1.2 不影响使用但影响优化的问题

> 在解决好实时内核问题后再研究下述的问题

- 在运行 MoveIt 的 GUI 界面时，每隔一段时间会闪退：

提示FCI通讯故障，或 UDP 延迟过大，而此时已经明确使用有线网线链接，且明确开启 FCI 控制权限：

大概率是由 ARP 错误引起的，可以使用 arp -a 来查看 `arp -a` `? (172.16.0.3) at <incomplete> on wlo1` 例如上面所示，查到通过有线 RJ45 接口链接的机器人 (即 172.16.0.3) 被错误的分配给了

Wi-Fi 模块，此时可以选择手动解析 mac 地址到 lan 口，也可以选择性临时禁用 Wi-Fi 模

块。此后再度执行命令，即正常。或者直接断开Wi-Fi链接，也能解决问题。

- 在运行MoveIt时，直接打不开：

同样会提示FCI通讯故障等问题。此时网络连接与配置均检查过是正常的 。

问题出在防火墙没有关闭，请使用命令:

```
ufw status
```

检查防火墙状态，如果防火墙未关闭，请关闭防火墙

* 如果上述方法都不能解决问题，请按照标准流程重启机械臂。（前提是上述办法都用过了还不行！）

---

## 2 机械臂本身操作

### 2.1 接线与准备工作

在正式操作 Franka Research 3 机械臂之前，请严格按照以下步骤完成接线与准备：

1. 电缆连接：确保连接机械臂与控制器的电缆在两侧均已牢固连接。

2. 外部激活设备：将外部激活设备（灰色按钮）连接至机械臂底座的 X4 端口

3. 紧急停止装置：将紧急停止装置（红色按钮）连接至机械臂底座的 X3 端口

4. 操作姿势：在后用机械臂并正式运行程序时，操作者需：
- 一只手轻握（不要握紧）住外部激活设备（灰色按钮）；

- 另一只手虚拖（不接触）紧急停止装置（红色按钮），以防止意外发生。

### 2.2 网络配置

#### 2.2.1 IP 地址分配

使用 FCI（Franka Control Interface）给机器人发送命令的工作站 PC，必须始终连接到控制器的 C2 端口，而非机械臂本体上的 X5 端口。控制器与工作站需配置在同一网段，推荐使用静态 IP 地址 Franka FR3 系统包含三个关键网络组件：

表 1: FR3 网络组件 IP 地址

| 设备 | IP 地址 | 接口说明 |

|---|---|---|

| 任一机械臂本体 | 192.168.0.1 | 机械臂底座网络接口 |

| 左侧机械臂控制器端口 | 172.16.0.3 | 连接外部网络（工作站） |

| 右侧机械臂控制器端口 | 172.16.0.2 | 连接外部网络（工作站） |

| 工作站 PC | 172.16.0.xx | 推荐静态 IP，确保与控制器同网段 |

#### 2.2.2 Ubuntu 工作站 IP 配置

在 Ubuntu 工作站上配置静态 IP 地址，**推荐通过图形界面完成**，步骤如下：

1. 打开网络设置：
- 点击屏幕右上角的网络图标；

- 选择【设置】或【网络设置】。
2. 选择网络连接：
- 在左侧列表中选择你要配置的有关连接（如“Wired connection 1”）；

- 点击右侧的齿轮图标，打开设置窗口。
3. 配置 IPv4 参数：
- 切换到【IPv4】标签页；

- 将【方法】设置为【手动】；

- 点击【添加】，输入以下信息：

- 地址（你的 PC）：172.16.0.xx

- 子网掩码：255.255.255.0（或 24）

- 网关（默认网关，通常就是控制器的 IP）：172.16.0.2/3

- DNS：输入 8.8.8.8, 8.8.4.4
4. 保存并应用：
- 点击【应用】；

- 断开并重新连接该网络，使配置生效。

### 网络验证

配置完成后，在终端输入：

```bash
ping 172.16.0.2/3
```

若能正常 ping 通且延迟小于 1 ms，说明网络配置成功。如需更详细的图文教程，请参考CSDN博客。

---

## 3 进入机械臂 GUI 界面（Desk）

### 3.1 访问Desk 界面

在 PC 端，打开浏览器，输入控制器的 IP 地址（172.16.0.3），即可进入 Franka 的 GUI 界面（Desk）。为便于教学演示，后文以左侧机械臂为例，即使用 IP 地址（172.16.0.3）

```bash
[http://172.16.0.3](http://172.16.0.3/)
```

### 3.2 解锁关节锁并激活FCI 模式

1. 在 Desk 界面中，首先点击右侧图形按钮解锁机器人的关节锁（Joints locker 抱闸）。

2. 释放机械臂上的灰色激活按钮（注意与外部激活设备区分）。

3. 当机械臂准备好后，蓝色 LED 指示灯将亮起，表示进入运行模式。

4. 点击 Desk 预置菜单中的 Activate FCI 按钮，激活 FCI 模式。

激活 FCI 模式后，会弹出提示窗口，表明 FCI 模式已激活。此时，Desk 界面将禁止交互操作，专注于外部程序控制。

警告

在 FCI 模式激活期间，请勿尝试通过 Desk 进行任何手动操作，以免干扰程序执行。

---

## 4 FCI 模式关机注意事项

完成实验或程序运行后，务必按以下步骤安全关闭系统：

1. 退出 FCI 模式：在 Desk 界面点击“Deactivate FCI”

2. 锁住抱闸：在 Desk 界面中，锁住机器人的抱闸

3. 等待系统关闭：保持电源连接，等待至少 30 秒（出现弹窗显示：“你现在可以断电了”）

4. 断开电源：先断开工作站电源，再断开控制器电源

关键步骤

必须等待 30 秒：直接断电可能导致控制器固件损坏！

错误关机顺序可能导致数据损坏或设备故障，请务必严格遵守！

---

## 5 过程中发生急停处理办法

如果在实验中机械臂突然爆红（机械臂Base处闪红灯），请不要慌张，严格按照下述步骤操作：

1. 自己/安全员立马按下紧急停止按钮，确保按到底

2. 在Desk API中观察机械臂状态，重新打开机器人抱闸

---

## 6 Docker 容器环境配置与程序运行

如需独立配置环境，请务必遵循以下步骤：

- 新建 Docker 镜像并创建容器：在容器内进行环境部署操作。

- 避免修改宿主机：严禁直接在宿主机上修改环境配置。如有特殊原因必须在宿主机上操作， 务必详细记录修改日志。即若对基础镜像进行了修改或创建了新镜像，请记录相关信息。

### 6.1 Docker 镜像获取与部署

由于我们调试的电脑已经基于镜像配置好容器，可以考虑直接跳到 5.2 继续阅读。

**注: 该镜像的作者为：田麟飞**

#### 6.1.1 前置条件

- 已正确安装 docker（建议版本 20.10）。

- 当前用户已加入 docker 用户组，或使用 sudo 运行。

- 确保网络畅通，能够访问 docker.io 或国内镜像源。

#### 6.1.2 镜像拉取

推荐从官方仓库拉取最新稳定镜像：

```bash
# 直接拉取（官方仓库）

docker pull frankalab/fr3-moveit:noetic

# 若国内网络较慢，可使用阿里云加速

docker pull registry.cn-hangzhou.aliyuncs.com/franka/fr3-moveit:noetic
```

可在 /etc/docker/daemon.json 中添加国内镜像源，例如：

json

```
{

"registry-mirrors": ["https://<your-mirror>.mirror.aliyuncs.com"]

}
```

修改后执行 `sudo systemctl restart docker` 生效。

#### 6.1.3 启用并运行容器

```bash
docker run -it \

--name frankahub_fixed \

--env="DISPLAY=$DISPLAY" \

--env="QT_X11_N0_MITSHM=1" \

--volume="/tmp/.X11-unix:/tmp/.X11-unix:rw" \

--volume="#HOME/.Xauthority:/root/.Xauthority:ro" \

--net=host \

--restart=unless-stopped \

docker.xuanyuan.me/nagisai201/frankahub:franka
```

上述代码启动一个带 GUI 的 Franka 实验容器，能在当前桌面弹出 RViz、Franka GUI 等窗口，并随系统重启自动恢复。

#### 6.1.4 容器生命周期管理

```bash
# 由于已经设置了容器自动启动，若要暂时退出容器，直接关闭bash即可

# 删除容器

docker rm fr3_workspace
```

#### 6.1.5 常见问题排查

- GUI 无法显示：确认宿主机已安装 xhost，并在宿主机执行 `xhost +local:docker`。

#### 6.1.6 性能优化建议

- 为容器指定 CPU 与内存限制，例如 `--cpus=4 --memory=8g` 根据宿主机资源调整。

- （选择性）若使用 NVIDIA GPU，可加载 nvidia-docker2 并添加 `--gnus all`。

### 6.2 进入 Docker 容器

在 Ubuntu 工作站上：

1. 使用快捷键 Ctrl + Alt + T 打开终端；

2. 查看已有容器：

```bash
docker ps
```

3. 进入指定容器：

```bash
docker exec -it fr3_workspace /bin/bash
```

### 6.3 运行 MoveIt 程序

==franka的URDF已经由田麟飞配置好==

进入容器后，执行以下命令启动 MoveIt：

```bash
ros2 launch franka_fr3_moveit_config moveit.launch.py robot_ip:=172.16.0.3
```

📌 启动成功提示

若命令成功执行，将自动打开 RViz 和 MoveIt 规划界面，您即可开始机械臂路径规划与控制。

# 7 如何二次开发Franka_fr3

目前笔者先介绍几种已经探明的方式，详细内容烦请各位补充。

* 使用libfranka直接进行底层控制
* 使用franka_ros2进行控制（轨迹与四元数平滑处理主要在ros2中的update函数里进行修改）

==以上两种方式都需要在对轨迹进行平滑处理，以达到高频次实时控制要求==

* 使用frankapy进行简单控制

==该控制方式仅可做展示，完全达不到科研的实时性要求==

* 使用高级控制器（配环境较为繁琐，还未完成）

---

### 贡献者名单

文档贡献者

| 姓名 | 单位 | 联系方式 |

| --- | ----------------- | ----------- |

| 万鹏 | 南京理工大学自动化学院 | 15254839222 |

| 滕海然 | 南京理工大学电子工程与光电技术学院 | 18252225336 |
